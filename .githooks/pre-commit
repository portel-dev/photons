#!/bin/bash
# Pre-commit hook: Auto-sync marketplace manifest before commit
# This ensures .marketplace/photons.json and .claude-plugin/ are always up-to-date

# Check if any .photon.ts files or marketplace files are being committed
if git diff --cached --name-only | grep -qE '\.photon\.ts$|\.marketplace/|\.claude-plugin/'; then
  echo "ğŸ”„ Syncing marketplace manifest..."

  # Run photon sync marketplace with --claude-code to generate plugin files
  if photon sync marketplace --claude-code; then
    # Stage the generated files
    git add .marketplace/photons.json README.md *.md .claude-plugin/ 2>/dev/null
    echo "âœ… Marketplace and Claude Code plugin synced and staged"
  else
    echo "âŒ Failed to sync marketplace"
    exit 1
  fi
fi

exit 0
